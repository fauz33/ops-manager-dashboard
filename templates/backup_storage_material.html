{% extends "base_material.html" %}

{% block title %}Backup Storage Configurations{% endblock %}
{% block page_title %}Backup Storage Configurations{% endblock %}
{% block page_subtitle %}Monitor backup storage configurations across all MongoDB Ops Manager instances{% endblock %}

{% block page_actions %}
<form method="post" style="display: inline;">
  <input type="hidden" name="refresh" value="true">
  <button type="submit" class="btn btn-primary" data-loading="true" title="Refresh data from API">
    <i class="ti ti-refresh me-1"></i>
    Refresh Data
  </button>
</form>
{% endblock %}

{% block content %}
<div class="page-wrapper">
  <!-- Status Alert -->
  {% if status_message %}
  <div class="container-xl">
    <div class="alert alert-{{ 'danger' if status_type == 'error' else status_type }} alert-dismissible" role="alert">
      <div class="d-flex">
        <div>
          <i class="ti ti-{% if status_type == 'success' %}check{% elif status_type == 'warning' %}alert-triangle{% else %}info-circle{% endif %} me-2"></i>
        </div>
        <div>
          {{ status_message }}
        </div>
      </div>
      <a class="btn-close" data-bs-dismiss="alert" aria-label="close"></a>
    </div>
  </div>
  {% endif %}

  <div class="page-body">
    <div class="container-xl">
      <!-- Summary Statistics -->
      <div class="row mb-4">
        <div class="col-sm-6 col-lg-3">
          <div class="card card-sm">
            <div class="card-body">
              <div class="row align-items-center">
                <div class="col-auto">
                  <span class="bg-blue text-white avatar">
                    <i class="ti ti-database"></i>
                  </span>
                </div>
                <div class="col">
                  <div class="font-weight-medium">Snapshot Blockstore</div>
                  <div class="text-muted">{{ snapshot_blockstore_data|length }} configurations</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="col-sm-6 col-lg-3">
          <div class="card card-sm">
            <div class="card-body">
              <div class="row align-items-center">
                <div class="col-auto">
                  <span class="bg-green text-white avatar">
                    <i class="ti ti-cloud"></i>
                  </span>
                </div>
                <div class="col">
                  <div class="font-weight-medium">Snapshot S3</div>
                  <div class="text-muted">{{ snapshot_s3_data|length }} configurations</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="col-sm-6 col-lg-3">
          <div class="card card-sm">
            <div class="card-body">
              <div class="row align-items-center">
                <div class="col-auto">
                  <span class="bg-orange text-white avatar">
                    <i class="ti ti-file-text"></i>
                  </span>
                </div>
                <div class="col">
                  <div class="font-weight-medium">Oplog Store</div>
                  <div class="text-muted">{{ oplog_store_data|length }} configurations</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="col-sm-6 col-lg-3">
          <div class="card card-sm">
            <div class="card-body">
              <div class="row align-items-center">
                <div class="col-auto">
                  <span class="bg-purple text-white avatar">
                    <i class="ti ti-cloud-upload"></i>
                  </span>
                </div>
                <div class="col">
                  <div class="font-weight-medium">Oplog S3</div>
                  <div class="text-muted">{{ oplog_s3_data|length }} configurations</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Region/Environment Filters -->
      <div class="row">
        <div class="col-lg-3">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">
                <i class="ti ti-filter me-2"></i>
                Filters
              </h3>
            </div>
            <div class="card-body">
              <form method="post" id="filterForm">
                <!-- Region Filter -->
                <div class="mb-3">
                  <label class="form-label">Regions</label>
                  <div class="form-selectgroup form-selectgroup-boxes d-flex flex-column">
                    {% for region in unique_region %}
                    <label class="form-selectgroup-item flex-fill">
                      <input type="checkbox" name="regions" value="{{ region }}" class="form-selectgroup-input"
                             {% if region in selected_regions %}checked{% endif %}>
                      <div class="form-selectgroup-label">{{ region }}</div>
                    </label>
                    {% endfor %}
                  </div>
                </div>
                
                <!-- Environment Filter -->
                <div class="mb-3">
                  <label class="form-label">Environments</label>
                  <div class="form-selectgroup form-selectgroup-boxes d-flex flex-column">
                    {% for env in unique_env %}
                    <label class="form-selectgroup-item flex-fill">
                      <input type="checkbox" name="environments" value="{{ env }}" class="form-selectgroup-input"
                             {% if env in selected_environments %}checked{% endif %}>
                      <div class="form-selectgroup-label">{{ env }}</div>
                    </label>
                    {% endfor %}
                  </div>
                </div>
                
                <button type="submit" class="btn btn-primary w-100">Apply Filters</button>
              </form>
              
              <!-- Table Filters -->
              {% if unique_storage_types or unique_opsmanagers %}
              <hr>
              <div class="mb-3">
                <h4 class="subheader mb-3">Table Filters</h4>
                
                {% if unique_storage_types %}
                <div class="mb-3">
                  <div class="d-flex justify-content-between align-items-center mb-2">
                    <label class="form-label mb-0">
                      <i class="ti ti-database me-1"></i>
                      Storage Type <span class="badge bg-secondary ms-1">{{ unique_storage_types|length }}</span>
                    </label>
                    <button type="button" class="btn btn-sm btn-ghost-secondary" onclick="toggleFilterGroup('storagetype')">
                      <i class="ti ti-chevron-down" id="storagetype-chevron"></i>
                    </button>
                  </div>
                  
                  <div id="storagetype-filter-group" class="collapse show">
                    <!-- Select All/None for Storage Type -->
                    <div class="mb-2 d-flex gap-1">
                      <button type="button" class="btn btn-sm btn-outline-secondary" 
                              onclick="selectAllFilters('.storagetype-filter', true)">
                        <i class="ti ti-check-all"></i> All
                      </button>
                      <button type="button" class="btn btn-sm btn-outline-secondary" 
                              onclick="selectAllFilters('.storagetype-filter', false)">
                        <i class="ti ti-x"></i> None
                      </button>
                    </div>
                    
                    <!-- Storage Type Filter Items -->
                    <div class="storagetype-filter-items" style="max-height: 200px; overflow-y: auto;">
                      {% for storage_type in unique_storage_types %}
                      <div class="storagetype-filter-item">
                        <div class="form-check form-check-sm mb-1">
                          <input class="form-check-input storagetype-filter" type="checkbox" 
                                id="storagetypeFilter{{ loop.index }}" 
                                value="{{ storage_type }}"
                                onchange="filterTables()">
                          <label class="form-check-label" for="storagetypeFilter{{ loop.index }}">
                            {{ storage_type.replace('_', ' ').title() }}
                          </label>
                        </div>
                      </div>
                      {% endfor %}
                    </div>
                  </div>
                </div>
                {% endif %}
                
                {% if unique_opsmanagers %}
                <div class="mb-3">
                  <div class="d-flex justify-content-between align-items-center mb-2">
                    <label class="form-label mb-0">
                      <i class="ti ti-server me-1"></i>
                      Ops Manager <span class="badge bg-secondary ms-1">{{ unique_opsmanagers|length }}</span>
                    </label>
                    <button type="button" class="btn btn-sm btn-ghost-secondary" onclick="toggleFilterGroup('opsmanager')">
                      <i class="ti ti-chevron-down" id="opsmanager-chevron"></i>
                    </button>
                  </div>
                  
                  <div id="opsmanager-filter-group" class="collapse show">
                    <!-- Select All/None for Ops Manager -->
                    <div class="mb-2 d-flex gap-1">
                      <button type="button" class="btn btn-sm btn-outline-secondary" 
                              onclick="selectAllFilters('.opsmanager-filter', true)">
                        <i class="ti ti-check-all"></i> All
                      </button>
                      <button type="button" class="btn btn-sm btn-outline-secondary" 
                              onclick="selectAllFilters('.opsmanager-filter', false)">
                        <i class="ti ti-x"></i> None
                      </button>
                    </div>
                    
                    <!-- Ops Manager Filter Items -->
                    <div class="opsmanager-filter-items" style="max-height: 200px; overflow-y: auto;">
                      {% for opsmanager in unique_opsmanagers %}
                      <div class="opsmanager-filter-item">
                        <div class="form-check form-check-sm mb-1">
                          <input class="form-check-input opsmanager-filter" type="checkbox" 
                                id="opsmanagerFilter{{ loop.index }}" 
                                value="{{ opsmanager }}"
                                onchange="filterTables()">
                          <label class="form-check-label" for="opsmanagerFilter{{ loop.index }}">
                            {{ opsmanager }}
                          </label>
                        </div>
                      </div>
                      {% endfor %}
                    </div>
                  </div>
                </div>
                {% endif %}
              </div>
              {% endif %}
              
            </div>
          </div>
        </div>

        <!-- Tables Section -->
        <div class="col-lg-9">
          
          <!-- Snapshot Blockstore Table -->
          <div class="card mb-4" id="snapshot-blockstore-section">
            <div class="card-header d-flex align-items-center justify-content-between">
              <h3 class="card-title">
                <i class="ti ti-database me-2 text-blue"></i>
                Snapshot MongoDB Blockstore
              </h3>
              <div class="card-actions d-flex align-items-center">
                {% if snapshot_blockstore_data|length > 0 %}
                <button type="button" class="btn btn-blue btn-sm me-2" onclick="exportTableToCSV('snapshot-blockstore-table', 'snapshot_blockstore')" title="Export to CSV">
                  <i class="ti ti-download"></i>
                  Export CSV
                </button>
                {% endif %}
                <span class="badge bg-blue fs-6">{{ snapshot_blockstore_data|length }} configs</span>
                <button type="button" class="btn btn-sm btn-ghost-secondary ms-2" onclick="toggleTable('snapshot-blockstore')">
                  <i class="ti ti-chevron-up" id="snapshot-blockstore-toggle"></i>
                </button>
              </div>
            </div>
            <div class="collapse show" id="snapshot-blockstore-collapse">
              {% if snapshot_blockstore_data|length > 0 %}
              <div class="card-body p-0">
                <div class="table-responsive">
                  <table class="table table-hover mb-0" id="snapshot-blockstore-table">
                    <thead>
                      <tr>
                        <th><i class="ti ti-server me-1"></i>Ops Manager</th>
                        <th><i class="ti ti-id me-1"></i>Configuration ID</th>
                        <th><i class="ti ti-link me-1"></i>URI</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for item in snapshot_blockstore_data %}
                      <tr>
                        <td><span class="text-muted">{{ item.get('Ops Manager', 'N/A') | truncate_url }}</span></td>
                        <td><code class="text-blue">{{ item.get('id', 'N/A') }}</code></td>
                        <td><span class="font-monospace text-info">{{ item.get('uri', 'N/A') }}</span></td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>
              {% else %}
              <div class="card-body">
                <div class="empty">
                  <div class="empty-img"><i class="ti ti-database" style="font-size: 48px; color: #6c757d;"></i></div>
                  <p class="empty-title">No Snapshot Blockstore configurations found</p>
                  <p class="empty-subtitle text-muted">No MongoDB blockstore configurations for snapshots in selected environments.</p>
                </div>
              </div>
              {% endif %}
            </div>
          </div>

          <!-- Snapshot S3 Table -->
          <div class="card mb-4" id="snapshot-s3-section">
            <div class="card-header d-flex align-items-center justify-content-between">
              <h3 class="card-title">
                <i class="ti ti-cloud me-2 text-green"></i>
                Snapshot S3 Configuration
              </h3>
              <div class="card-actions d-flex align-items-center">
                {% if snapshot_s3_data|length > 0 %}
                <button type="button" class="btn btn-green btn-sm me-2" onclick="exportTableToCSV('snapshot-s3-table', 'snapshot_s3')" title="Export to CSV">
                  <i class="ti ti-download"></i>
                  Export CSV
                </button>
                {% endif %}
                <span class="badge bg-green fs-6">{{ snapshot_s3_data|length }} configs</span>
                <button type="button" class="btn btn-sm btn-ghost-secondary ms-2" onclick="toggleTable('snapshot-s3')">
                  <i class="ti ti-chevron-up" id="snapshot-s3-toggle"></i>
                </button>
              </div>
            </div>
            <div class="collapse show" id="snapshot-s3-collapse">
              {% if snapshot_s3_data|length > 0 %}
              <div class="card-body p-0">
                <div class="table-responsive">
                  <table class="table table-hover mb-0" id="snapshot-s3-table">
                    <thead>
                      <tr>
                        <th><i class="ti ti-server me-1"></i>Ops Manager</th>
                        <th><i class="ti ti-id me-1"></i>Configuration ID</th>
                        <th><i class="ti ti-link me-1"></i>URI</th>
                        <th><i class="ti ti-bucket me-1"></i>S3 Bucket</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for item in snapshot_s3_data %}
                      <tr>
                        <td><span class="text-muted">{{ item.get('Ops Manager', 'N/A') | truncate_url }}</span></td>
                        <td><code class="text-green">{{ item.get('id', 'N/A') }}</code></td>
                        <td><span class="font-monospace text-info">{{ item.get('uri', 'N/A') }}</span></td>
                        <td>
                          {% if item.get('bucket_name') and item.get('bucket_name') != 'N/A' %}
                          <span class="badge bg-green-lt">{{ item.get('bucket_name') }}</span>
                          {% else %}
                          <span class="text-muted">-</span>
                          {% endif %}
                        </td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>
              {% else %}
              <div class="card-body">
                <div class="empty">
                  <div class="empty-img"><i class="ti ti-cloud" style="font-size: 48px; color: #6c757d;"></i></div>
                  <p class="empty-title">No Snapshot S3 configurations found</p>
                  <p class="empty-subtitle text-muted">No S3 configurations for snapshots in selected environments.</p>
                </div>
              </div>
              {% endif %}
            </div>
          </div>

          <!-- Oplog Store Table -->
          <div class="card mb-4" id="oplog-store-section">
            <div class="card-header d-flex align-items-center justify-content-between">
              <h3 class="card-title">
                <i class="ti ti-file-text me-2 text-orange"></i>
                Oplog MongoDB Storage
              </h3>
              <div class="card-actions d-flex align-items-center">
                {% if oplog_store_data|length > 0 %}
                <button type="button" class="btn btn-orange btn-sm me-2" onclick="exportTableToCSV('oplog-store-table', 'oplog_store')" title="Export to CSV">
                  <i class="ti ti-download"></i>
                  Export CSV
                </button>
                {% endif %}
                <span class="badge bg-orange fs-6">{{ oplog_store_data|length }} configs</span>
                <button type="button" class="btn btn-sm btn-ghost-secondary ms-2" onclick="toggleTable('oplog-store')">
                  <i class="ti ti-chevron-up" id="oplog-store-toggle"></i>
                </button>
              </div>
            </div>
            <div class="collapse show" id="oplog-store-collapse">
              {% if oplog_store_data|length > 0 %}
              <div class="card-body p-0">
                <div class="table-responsive">
                  <table class="table table-hover mb-0" id="oplog-store-table">
                    <thead>
                      <tr>
                        <th><i class="ti ti-server me-1"></i>Ops Manager</th>
                        <th><i class="ti ti-id me-1"></i>Configuration ID</th>
                        <th><i class="ti ti-link me-1"></i>URI</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for item in oplog_store_data %}
                      <tr>
                        <td><span class="text-muted">{{ item.get('Ops Manager', 'N/A') | truncate_url }}</span></td>
                        <td><code class="text-orange">{{ item.get('id', 'N/A') }}</code></td>
                        <td><span class="font-monospace text-info">{{ item.get('uri', 'N/A') }}</span></td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>
              {% else %}
              <div class="card-body">
                <div class="empty">
                  <div class="empty-img"><i class="ti ti-file-text" style="font-size: 48px; color: #6c757d;"></i></div>
                  <p class="empty-title">No Oplog Store configurations found</p>
                  <p class="empty-subtitle text-muted">No MongoDB oplog storage configurations in selected environments.</p>
                </div>
              </div>
              {% endif %}
            </div>
          </div>

          <!-- Oplog S3 Table -->
          <div class="card mb-4" id="oplog-s3-section">
            <div class="card-header d-flex align-items-center justify-content-between">
              <h3 class="card-title">
                <i class="ti ti-cloud-upload me-2 text-purple"></i>
                Oplog S3 Configuration
              </h3>
              <div class="card-actions d-flex align-items-center">
                {% if oplog_s3_data|length > 0 %}
                <button type="button" class="btn btn-purple btn-sm me-2" onclick="exportTableToCSV('oplog-s3-table', 'oplog_s3')" title="Export to CSV">
                  <i class="ti ti-download"></i>
                  Export CSV
                </button>
                {% endif %}
                <span class="badge bg-purple fs-6">{{ oplog_s3_data|length }} configs</span>
                <button type="button" class="btn btn-sm btn-ghost-secondary ms-2" onclick="toggleTable('oplog-s3')">
                  <i class="ti ti-chevron-up" id="oplog-s3-toggle"></i>
                </button>
              </div>
            </div>
            <div class="collapse show" id="oplog-s3-collapse">
              {% if oplog_s3_data|length > 0 %}
              <div class="card-body p-0">
                <div class="table-responsive">
                  <table class="table table-hover mb-0" id="oplog-s3-table">
                    <thead>
                      <tr>
                        <th><i class="ti ti-server me-1"></i>Ops Manager</th>
                        <th><i class="ti ti-id me-1"></i>Configuration ID</th>
                        <th><i class="ti ti-link me-1"></i>URI</th>
                        <th><i class="ti ti-bucket me-1"></i>S3 Bucket</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for item in oplog_s3_data %}
                      <tr>
                        <td><span class="text-muted">{{ item.get('Ops Manager', 'N/A') | truncate_url }}</span></td>
                        <td><code class="text-purple">{{ item.get('id', 'N/A') }}</code></td>
                        <td><span class="font-monospace text-info">{{ item.get('uri', 'N/A') }}</span></td>
                        <td>
                          {% if item.get('bucket_name') and item.get('bucket_name') != 'N/A' %}
                          <span class="badge bg-purple-lt">{{ item.get('bucket_name') }}</span>
                          {% else %}
                          <span class="text-muted">-</span>
                          {% endif %}
                        </td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>
              {% else %}
              <div class="card-body">
                <div class="empty">
                  <div class="empty-img"><i class="ti ti-cloud-upload" style="font-size: 48px; color: #6c757d;"></i></div>
                  <p class="empty-title">No Oplog S3 configurations found</p>
                  <p class="empty-subtitle text-muted">No S3 oplog configurations in selected environments.</p>
                </div>
              </div>
              {% endif %}
            </div>
          </div>

        </div>
      </div>
      
      <!-- Cache Information -->
      {% if cache_timestamp %}
      <div class="row mt-3">
        <div class="col-12">
          <div class="card">
            <div class="card-body py-2">
              <div class="d-flex align-items-center text-muted">
                <i class="ti ti-clock me-2"></i>
                <small>Last refreshed: <span id="cache-timestamp" data-timestamp="{{ cache_timestamp }}">{{ cache_timestamp }}</span></small>
              </div>
            </div>
          </div>
        </div>
      </div>
      {% endif %}
      
    </div>
  </div>
</div>

<script>
// Table collapse/expand functionality
function toggleTable(tableType) {
  const collapse = document.getElementById(tableType + '-collapse');
  const toggle = document.getElementById(tableType + '-toggle');
  
  if (collapse.classList.contains('show')) {
    collapse.classList.remove('show');
    toggle.classList.remove('ti-chevron-up');
    toggle.classList.add('ti-chevron-down');
  } else {
    collapse.classList.add('show');
    toggle.classList.remove('ti-chevron-down');
    toggle.classList.add('ti-chevron-up');
  }
}

// Export individual table to CSV
function exportTableToCSV(tableId, storageType) {
  const table = document.getElementById(tableId);
  const rows = table.querySelectorAll('tr');
  const csvContent = [];
  
  // Header row
  const headerCells = rows[0].querySelectorAll('th');
  const headerRow = Array.from(headerCells).map(cell => `"${cell.textContent.trim().replace(/\s+/g, ' ')}"`);
  csvContent.push(headerRow.join(','));
  
  // Data rows
  for (let i = 1; i < rows.length; i++) {
    const cells = rows[i].querySelectorAll('td');
    const rowData = [];
    
    for (let j = 0; j < cells.length; j++) {
      let cellText = cells[j].textContent.trim();
      cellText = cellText.replace(/\s+/g, ' ');
      rowData.push(`"${cellText}"`);
    }
    csvContent.push(rowData.join(','));
  }
  
  // Create and download CSV
  const csvString = csvContent.join('\n');
  const blob = new Blob([csvString], { type: 'text/csv;charset=utf-8;' });
  const link = document.createElement('a');
  const url = URL.createObjectURL(blob);
  link.setAttribute('href', url);
  link.setAttribute('download', `${storageType}_configurations_${new Date().toISOString().split('T')[0]}.csv`);
  link.style.visibility = 'hidden';
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

// Convert timestamp to local time
function convertTimestampToLocal() {
  const timestampElement = document.getElementById('cache-timestamp');
  if (timestampElement) {
    const timestamp = timestampElement.getAttribute('data-timestamp');
    if (timestamp) {
      const date = new Date(timestamp);
      timestampElement.textContent = date.toLocaleString();
    }
  }
}

// Filter functionality
function toggleFilterGroup(groupName) {
  const group = document.getElementById(groupName + '-filter-group');
  const chevron = document.getElementById(groupName + '-chevron');
  
  if (group.classList.contains('show')) {
    group.classList.remove('show');
    chevron.classList.remove('ti-chevron-up');
    chevron.classList.add('ti-chevron-down');
  } else {
    group.classList.add('show');
    chevron.classList.remove('ti-chevron-down');
    chevron.classList.add('ti-chevron-up');
  }
}

function selectAllFilters(checkboxSelector, selectAll) {
  const checkboxes = document.querySelectorAll(checkboxSelector);
  checkboxes.forEach(checkbox => {
    checkbox.checked = selectAll;
  });
  filterTables();
}

function filterTables() {
  // Get selected storage types
  const storageTypeFilters = Array.from(document.querySelectorAll('.storagetype-filter:checked')).map(cb => cb.value);
  const opsManagerFilters = Array.from(document.querySelectorAll('.opsmanager-filter:checked')).map(cb => cb.value);
  
  // Filter each table
  filterTable('snapshot-blockstore-table', storageTypeFilters, opsManagerFilters, 'snapshot_blockstore');
  filterTable('snapshot-s3-table', storageTypeFilters, opsManagerFilters, 'snapshot_s3');
  filterTable('oplog-store-table', storageTypeFilters, opsManagerFilters, 'oplog_store');
  filterTable('oplog-s3-table', storageTypeFilters, opsManagerFilters, 'oplog_s3');
}

function filterTable(tableId, storageTypeFilters, opsManagerFilters, tableStorageType) {
  const table = document.getElementById(tableId);
  if (!table) return;
  
  const rows = table.querySelectorAll('tbody tr');
  let visibleCount = 0;
  
  rows.forEach(row => {
    let showRow = true;
    
    // Check storage type filter
    if (storageTypeFilters.length > 0) {
      showRow = showRow && storageTypeFilters.includes(tableStorageType);
    }
    
    // Check ops manager filter
    if (opsManagerFilters.length > 0 && showRow) {
      const opsManagerCell = row.cells[3]; // Ops Manager is typically 4th column (index 3)
      const opsManagerText = opsManagerCell ? opsManagerCell.textContent.trim() : '';
      showRow = showRow && opsManagerFilters.some(filter => opsManagerText.includes(filter));
    }
    
    if (showRow) {
      row.style.display = '';
      visibleCount++;
    } else {
      row.style.display = 'none';
    }
  });
  
  // Update badge count in the card header
  const section = document.getElementById(tableId.replace('-table', '-section'));
  if (section) {
    const badge = section.querySelector('.badge');
    if (badge) {
      const totalCount = badge.textContent.match(/\d+/);
      if (totalCount) {
        badge.textContent = `${visibleCount} of ${totalCount[0]} configs`;
        badge.className = visibleCount > 0 ? 'badge bg-primary fs-6' : 'badge bg-secondary fs-6';
      }
    }
  }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
  convertTimestampToLocal();
  
  // Initialize all table filters to show all items
  selectAllFilters('.storagetype-filter', true);
  selectAllFilters('.opsmanager-filter', true);
});
</script>
{% endblock %}